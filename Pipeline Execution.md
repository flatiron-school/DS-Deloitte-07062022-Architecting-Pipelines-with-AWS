# Pipeline Execution

##### [Source](https://docs.aws.amazon.com/sagemaker/latest/dg/run-pipeline.html)

After youâ€™ve created a pipeline definition, you can submit it to SageMaker to start your execution. This notebook shows how to submit a pipeline, start an execution, examine the results of that execution, and delete your pipeline.

**Note:** *Add these lines of code to the SageMaker [notebook used for pipeline definition](https://github.com/flatiron-school/DS-Deloitte-07062022-Architecting-Pipelines-with-AWS/blob/main/Pipeline%20Creation%20with%20AWS.ipynb).* 

## Workflow

1. Submit the pipeline definition to the SageMaker Pipelines service to create a pipeline if it doesn't exist, or update the pipeline if it does. The role passed in is used by SageMaker Pipelines to create all of the jobs defined in the steps.


```python
pipeline.upsert(role_arn=role)
```

2. Start pipeline execution.


```python
execution = pipeline.start()
```

3. Describe the pipeline execution status to ensure that it has been created and started successfully.


```python
execution.describe()
```

4. Wait for the pipeline execution to finish.


```python
execution.wait()
```

5. List the execution steps and their status.


```python
execution.list_steps()
```

**Note:** *You can run additional executions of the pipeline by specifying different pipeline parameters to override the defaults.*

### To override default parameters

1. Create the pipeline execution. This starts another pipeline execution with the model approval status override set to "Approved". This means that the model package version generated by the RegisterModel step is automatically ready for deployment through CI/CD pipelines, such as with SageMaker Projects. For more info, see [Automate MLOps with SageMaker Projects.](https://docs.aws.amazon.com/sagemaker/latest/dg/sagemaker-projects.html).


```python
execution = pipeline.start(
    parameters=dict(
        ModelApprovalStatus="Approved",
    )
)
```

2. After your pipeline execution is complete, download the resulting `evaluation.json` file from Amazon S3 to examine the report.


```python
evaluation_json = sagemaker.s3.S3Downloader.read_file("{}/evaluation.json".format(
    step_eval.arguments["ProcessingOutputConfig"]["Outputs"][0]["S3Output"]["S3Uri"]
))

json.loads(evaluation_json)
```

### To Stop and Delete Pipeline Execution

When you're finished with your pipeline, you can stop any ongoing executions and delete the pipeline.

1. Stop the pipeline execution.


```python
execution.stop()
```

2. Delete the pipeline.


```python
pipeline.delete()
```
